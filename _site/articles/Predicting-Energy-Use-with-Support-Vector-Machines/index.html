<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Forecasting with Machine Learning &#8211; The Training Set.</title>
<meta name="description" content="Using a machine learning algorithm for predicting next-hour electricity consumption.">
<meta name="keywords" content="machine-learning, smart-meters, predictive-analytics, electricity, demand-side, support-vector-machine">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://www.thetrainingset.com/images/">
<meta name="twitter:title" content="Forecasting with Machine Learning">
<meta name="twitter:description" content="Using a machine learning algorithm for predicting next-hour electricity consumption.">
<meta name="twitter:creator" content="@jtelszasz">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Forecasting with Machine Learning">
<meta property="og:description" content="Using a machine learning algorithm for predicting next-hour electricity consumption.">
<meta property="og:url" content="http://www.thetrainingset.com/articles/Predicting-Energy-Use-with-Support-Vector-Machines">
<meta property="og:site_name" content="The Training Set.">





<link rel="canonical" href="http://www.thetrainingset.com/articles/Predicting-Energy-Use-with-Support-Vector-Machines">
<link href="http://www.thetrainingset.com/feed.xml" type="application/atom+xml" rel="alternate" title="The Training Set. Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://www.thetrainingset.com/assets/css/main.min.css">
<!-- Webfonts -->
<link href="http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="http://www.thetrainingset.com/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://www.thetrainingset.com/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://www.thetrainingset.com/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://www.thetrainingset.com/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://www.thetrainingset.com/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://www.thetrainingset.com/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://www.thetrainingset.com/images/apple-touch-icon-144x144-precomposed.png">



</head>

<body id="post" >

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="http://www.thetrainingset.com">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="http://www.thetrainingset.com/images/bio-photo.jpg" alt="Justin Elszasz photo" class="author-photo">
					<h4>Justin Elszasz</h4>
					<p>Engineering background, indeterminate foreground.</p>
				</li>
				<li><a href="http://www.thetrainingset.com/about/">Learn More</a></li>
				
				<li>
					<a href="http://twitter.com/jtelszasz"><i class="fa fa-twitter"></i> Twitter</a>
				</li>
				
				
				<li>
					<a href="http://linkedin.com/in/justinelszasz"><i class="fa fa-linkedin"></i> LinkedIn</a>
				</li>
				<li>
					<a href="http://github.com/jtelszasz"><i class="fa fa-github"></i> GitHub</a>
				</li>
				
				
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="http://www.thetrainingset.com/posts/">All Posts</a></li>
				<li><a href="http://www.thetrainingset.com/tags/">All Tags</a></li>
			</ul>
		</li>
		<li><a href="http://www.thetrainingset.com/the-work/">The Work</a></li><li><a href="http://www.thetrainingset.com/my-elec-use/">My Electricity Use</a></li>
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->




<div id="main" role="main">
  <article class="hentry">
    <header class="header-title">
      <div class="header-title-wrap">
        
          <h1 class="entry-title"><a href="http://www.thetrainingset.com/articles/Predicting-Energy-Use-with-Support-Vector-Machines" rel="bookmark" title="Forecasting with Machine Learning">Forecasting with Machine Learning</a></h1>
        
        <h2>May 08, 2014</h2>
        
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content">
      <p>Taking a big jump into machine learning now.</p>

<p>As part of my research in grad school I had started getting interested in the use of machine learning tools for predicting energy consumption.  I went so far as to enroll in a machine learning class, but lacking the some of the statistical/mathematical knowledge for what they were teaching I ended up dropping about three-quarters of the way through.  I’ve since gone back on my own time and learned more statisical inference through online coursework, and am taking a stab at some analysis and coding.</p>

<h3 id="i-thought-we-had-a-model">I Thought We Had a Model</h3>

<p>In <a href="http://www.thetrainingset.com/articles/Energy-Use-and-Weather/">another post</a> I plotted electricity consumption against outdoor temperature and fit a straight line to the data.  </p>

<center>
<figure>
  <a href="http://www.thetrainingset.com/images/2014-05/Elec_and_Temp_OLS.png"><img src="http://www.thetrainingset.com/images/2014-05/Elec_and_Temp_OLS.png" /></a>
  <figcaption>Linear ordinary least squares regression model for electricity consumption using outdoor temperature.</figcaption>
</figure>
</center>

<p>Let’s be honest: in terms of predictive capacity, this model sucks.  What if I needed to predict what the electricity consumption would be in the next hour?  The prediction would be on the line - I measure what the outdoor temperature is and read off the corresponding consumption from the blue line.  But look at how far the actual usage is scattered.  Unless I got very lucky, I’d be way off.  (In fact, I think using Bayesian regression I could quantify that probability, but that’s for another post.)</p>

<p>Clearly the linear assumption doesn’t tell the whole story.  It doesn’t capture other aspects of the weather (wind and sun) and especially human behavior that all influence the amount of electricity consumed.  </p>

<h3 id="enter-machine-learning">Enter Machine Learning</h3>

<p>Certainly there are other simpler modeling approaches I can take, and I’d like to learn more about those as well.  But because Python and Scikit-learn have made it so easy and intuitive, I jumped straight into the deep end with support vector machines.  Support vector machines find an <em>optimal</em> regression or classification model, minimizing both the error on the training data while minimizing the complexity of the model itself so that it will be generalized for new data (prediction).</p>

<p>Support vector machines can be used for classification or regression.  As with other machine learning algorithms, the model is first “trained” using a (hopefully large) dataset.  The model parameters are optimized until a balance is struck between errors and model simplicity, a balance that is user adjusted.</p>

<p>I should also say very clearly that I’m not breaking any new ground here, in fact <a href="http://web.eecs.utk.edu/~leparker/publications/Energy-Buildings-2012.pdf">this paper</a> compares several algorithms on similar household energy demand data sets to what I’m using (sensor-based time series) and using similar inputs (weather variables, hour of day, workday/holiday indicator).</p>

<h3 id="modeling">Modeling</h3>

<p>Based on some of the <a href="http://www.thetrainingset.com/articles/Autocorrelation">previous explorations of the data</a>, it looked like one hour’s electricity usage could be a very good predictor of the next hour’s usage.  In fact, it looked like it was a much better indicator than the <a href="http://www.thetrainingset.com/articles/Energy-Use-and-Weather">outdoor temperature</a>.  I wonder how far that alone will get us.</p>

<p>Well, not completely alone.  There are two other easy time-related variables I’d like to include.  One is the hour of the day (1 through 24, though these each need a feature unto themselves to make each hour equal to a categorical 0 or 1) and a field for whether or not the day was a typical work day or not (“not” would include holidays, weekends, and days I worked from home).  I would expect there to be a pattern of electricity usage associated with both of these variables and we can include them at virtually no modeling expense.</p>

<center>
<figure>
  <a href="http://www.thetrainingset.com/images/2014-05/SVM_training_set.png"><img src="http://www.thetrainingset.com/images/2014-05/SVM_training_set.png" /></a>
  <figcaption>The training set.</figcaption>
</figure>
</center>

<p>As a training set, I’m using the hourly data between January 18 and March 24.  The testing set will consist of March 25 through March 31.</p>

<h3 id="support-vector-regression-with-scikit-learn">Support Vector Regression with Scikit-learn</h3>

<p>The Scikit-learn package for Python makes using machine learning algorithms simple and clean.  There is even a preprocessing module that does the scaling/normalization that should be done before building a model.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">preprocessing</span> <span class="k">as</span> <span class="n">pre</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">pre</span><span class="o">.</span><span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_train_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_test_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span></code></pre></div>

<p>Then to actually train the support vector regression model, I simply call the <em>fit</em> function of the SVR class using the training data-target pairs.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">SVR_model</span> <span class="o">=</span> <span class="n">svm</span><span class="o">.</span><span class="n">SVR</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s">&#39;rbf&#39;</span><span class="p">,</span><span class="n">C</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">gamma</span><span class="o">=.</span><span class="mo">001</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_scaled</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span></code></pre></div>

<p>The kernel <em>rbf</em> is a radial basis function.  This kernel transforms the data into a higher dimensional space when performing the regression.  This generally results in more robust modelling of nonlinearities.  The <em>C</em> and <em>gamma</em> parameters are the user-adjustments I alluded to earlier that allow the model to strike a balance between tightly fitting the training data while keeping the simplest model possible.  For this first test case, I just manually adjusted them by order of magnitude until the <img src="http://latex.codecogs.com/png.latex?R^2" alt="R^2" />  I was getting over the test set was as high as possible.  A better approach would be to do a proper cross-validation that finds the best parameters for the these data.</p>

<p>Now to generate the prediction over the test data, I just call the <em>predict</em> function on the <em>SVM_model</em> object that I created (the trained model).</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">predict_y_array</span> <span class="o">=</span> <span class="n">SVR_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_scaled</span><span class="p">)</span></code></pre></div>

<p>Since I know what the actual hourly usage was over the testing period, I can calculate an <img src="http://latex.codecogs.com/png.latex?R^2" alt="R^2" /> for this testing set, which results in 0.732.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">SVR_model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test_scaled</span><span class="p">,</span><span class="n">y_test</span><span class="p">)</span></code></pre></div>

<center>
<figure>
  <a href="http://www.thetrainingset.com/images/2014-05/SVM_predict_TS.png"><img src="http://www.thetrainingset.com/images/2014-05/SVM_predict_TS.png" /></a>
  <figcaption>Predicted (SVR, next-hour) and actual hourly electricity usage.</figcaption>
</figure>
</center>

<p>It’s important to remember that this entire timespan wasn’t calculated in one go - each hour’s actual usage would have been used to help predict the next hour’s.  We’re always forecasting the next hour consumption in this scenario.</p>

<p>One way to visualize the accuracy of the predictions is to plot them against the actual values.  If the predictions were 100% accurate, all the points would lie on the 45 degree line shown in black.  It’s a good sign that the points are distributed rather evenly above and below the line; it suggests that there is little bias (systematic under- or over-estimating).  In another post I’ll dig in a little more on evaluating the model.</p>

<center>
<figure>
  <a href="http://www.thetrainingset.com/images/2014-05/SVM_plot_errors.png"><img src="http://www.thetrainingset.com/images/2014-05/SVM_plot_errors.png" /></a>
  <figcaption>Errors.</figcaption>
</figure>
</center>


      <footer class="entry-meta">
        <span class="entry-tags"><a href="http://www.thetrainingset.com/tags/#machine-learning" title="Pages tagged machine-learning" class="tag">machine-learning</a><a href="http://www.thetrainingset.com/tags/#smart-meters" title="Pages tagged smart-meters" class="tag">smart-meters</a><a href="http://www.thetrainingset.com/tags/#predictive-analytics" title="Pages tagged predictive-analytics" class="tag">predictive-analytics</a><a href="http://www.thetrainingset.com/tags/#electricity" title="Pages tagged electricity" class="tag">electricity</a><a href="http://www.thetrainingset.com/tags/#demand-side" title="Pages tagged demand-side" class="tag">demand-side</a><a href="http://www.thetrainingset.com/tags/#support-vector-machine" title="Pages tagged support-vector-machine" class="tag">support-vector-machine</a></span>
        <span><a href="http://www.thetrainingset.com/articles/Predicting-Energy-Use-with-Support-Vector-Machines" rel="bookmark" title="Forecasting with Machine Learning">Forecasting with Machine Learning</a> was published on <span class="entry-date date published updated"><time datetime="2014-05-08T00:00:00-04:00">May 08, 2014</time></span></span>
        (revised: <span class="entry-date date modified"><time datetime="2014-05-08">05/08/2014</time></span>)
        <span class="author vcard"><span class="fn"><a href="http://www.thetrainingset.com/about/" title="About Justin Elszasz">Justin Elszasz</a></span></span>
        <div class="social-share">
          <ul class="socialcount socialcount-small inline-list">
            <li class="facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=http://www.thetrainingset.com/articles/Predicting-Energy-Use-with-Support-Vector-Machines" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Like</span></a></li>
            <li class="twitter"><a href="https://twitter.com/intent/tweet?text=http://www.thetrainingset.com/articles/Predicting-Energy-Use-with-Support-Vector-Machines" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a></li>
            <li class="googleplus"><a href="https://plus.google.com/share?url=http://www.thetrainingset.com/articles/Predicting-Energy-Use-with-Support-Vector-Machines" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a></li>
          </ul>
        </div><!-- /.social-share -->
      </footer>
    </div><!-- /.entry-content -->
    
    
    <div class="read-more">
      
        <div class="read-more-header">
          <a href="http://www.thetrainingset.com/articles/Autocorrelation" class="read-more-btn">Read More</a>
        </div><!-- /.read-more-header -->
        <div class="read-more-content">
          <h3><a href="http://www.thetrainingset.com/articles/Buiding-My-Elec-Use-Visualization-Site" title="Introducing "My Electricity Use" Visualization Page">Introducing "My Electricity Use" Visualization Page</a></h3>
          <p>Building a page for interactive visualizations of my electricity use data. <a href="http://www.thetrainingset.com/articles/Buiding-My-Elec-Use-Visualization-Site">Continue reading</a></p>
        </div><!-- /.read-more-content -->
      
      <div class="read-more-list">
        
          <div class="list-item">
            <h4><a href="http://www.thetrainingset.com/articles/My-Block-Is-A-Target" title="My Block is a Target.">My Block is a Target.</a></h4>
            <span>Published on February 10, 2015</span>
          </div><!-- /.list-item -->
        
          <div class="list-item">
            <h4><a href="http://www.thetrainingset.com/articles/Quick-Response-From-Baltimore-Chief-Data-Officer" title="Quick Response from Baltimore Chief Data Officer">Quick Response from Baltimore Chief Data Officer</a></h4>
            <span>Published on January 23, 2015</span>
          </div><!-- /.list-item -->
        
      </div><!-- /.read-more-list -->
      
    </div><!-- /.read-more -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2015 Justin Elszasz. Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <a href="http://mademistakes.com/hpstr/">HPSTR Theme</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://www.thetrainingset.com/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://www.thetrainingset.com/assets/js/scripts.min.js"></script>

	        

</body>
</html>
