<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Intro to Storage Model &#8211; The Training Set.</title>
<meta name="description" content="Introducing the demand-side storage model.">
<meta name="keywords" content="BGE, Green-Button, data, electricity, dynamic-pricing, storage, model, demand-side">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://www.thetrainingset.com/images/">
<meta name="twitter:title" content="Intro to Storage Model">
<meta name="twitter:description" content="Introducing the demand-side storage model.">
<meta name="twitter:creator" content="@jtelszasz">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Intro to Storage Model">
<meta property="og:description" content="Introducing the demand-side storage model.">
<meta property="og:url" content="http://www.thetrainingset.com/articles/Intro-To-Storage-Model">
<meta property="og:site_name" content="The Training Set.">





<link rel="canonical" href="http://www.thetrainingset.com/articles/Intro-To-Storage-Model">
<link href="http://www.thetrainingset.com/feed.xml" type="application/atom+xml" rel="alternate" title="The Training Set. Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://www.thetrainingset.com/assets/css/main.min.css">
<!-- Webfonts -->
<link href="http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="http://www.thetrainingset.com/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://www.thetrainingset.com/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://www.thetrainingset.com/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://www.thetrainingset.com/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://www.thetrainingset.com/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://www.thetrainingset.com/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://www.thetrainingset.com/images/apple-touch-icon-144x144-precomposed.png">



</head>

<body id="post" >

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="http://www.thetrainingset.com">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="http://www.thetrainingset.com/images/bio-photo.jpg" alt="Justin Elszasz photo" class="author-photo">
					<h4>Justin Elszasz</h4>
					<p>Engineering background, indeterminate foreground.</p>
				</li>
				<li><a href="http://www.thetrainingset.com/about/">Learn More</a></li>
				
				<li>
					<a href="http://twitter.com/jtelszasz"><i class="fa fa-twitter"></i> Twitter</a>
				</li>
				
				
				<li>
					<a href="http://linkedin.com/in/justinelszasz"><i class="fa fa-linkedin"></i> LinkedIn</a>
				</li>
				<li>
					<a href="http://github.com/jtelszasz"><i class="fa fa-github"></i> GitHub</a>
				</li>
				
				
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="http://www.thetrainingset.com/posts/">All Posts</a></li>
				<li><a href="http://www.thetrainingset.com/tags/">All Tags</a></li>
			</ul>
		</li>
		<li><a href="http://www.thetrainingset.com/the-work/">The Work</a></li><li><a href="http://www.thetrainingset.com/my-elec-use/">My Electricity Use</a></li>
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->




<div id="main" role="main">
  <article class="hentry">
    <header class="header-title">
      <div class="header-title-wrap">
        
          <h1 class="entry-title"><a href="http://www.thetrainingset.com/articles/Intro-To-Storage-Model" rel="bookmark" title="Intro to Storage Model">Intro to Storage Model</a></h1>
        
        <h2>September 23, 2014</h2>
        
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content">
      <p>Buying lead-acid batteries and switching to one of <a href="http://www.thetrainingset.com/articles/BGE-Pricing">BGE’s time-of-use pricing plans</a> may be a very good idea indeed.</p>

<p>BGE (and many other utilities in the U.S.) are now offering a time-of-use pricing plan in which the price you pay for electricity depends on what time of day or season you are purchasing it.  This is one of the so-called “demand-side strategies” that could help utilities reduce peak loads and prevent blackouts.  In a <a href="http://www.thetrainingset.com/articles/Should-I-Switch-To-TOU-Pricing">previous post</a>, I looked at whether it would make financial sense for me to switch over to one of these plans.</p>

<p>One can imagine taking further advantage of these plans by purchasing most or all electricity during off-peak (cheap) hours without having to buy much or any during peak hours.  In order to explore how this might work and how beneficial it would be, I built a model in Python that simulates the hourly energy flows for a home with lead-acid battery storage.</p>

<p>There are two sources of data that drive the model.  First, I’ve used one of the <a href="http://www.thetrainingset.com/articles/Feeding-The-Data-Monster">Green Button sample data files</a>, specifically the one for an inland, single-family residence.  This is an hourly electricity demand profile for the whole residential building for all of 2011.  Second, I’ve again used <a href="http://www.thetrainingset.com/articles/BGE-Pricing">BGE’s time-of-use pricing schemes</a> to determine peak hours and costs.  Some of the ideas are based on <a href="http://sel.columbia.edu/matlab-assignment-1">a Matlab assignment I worked on in grad school</a>.  While I no longer have access to the top tier journals (Elsevier is a capitalist racket), I did find a couple papers <a href="https://www.thlab.net/wp-content/uploads/publications/pub_19.pdf">here</a> and <a href="http://www.ecs.umass.edu/~irwin/smartcharge.pdf">here</a> that are using similar algorithms.</p>

<p>I’ve drawn out a flow chart to show how the model works.  During off-peak times, the demand is served directly from the grid and if the battery isn’t full, extra energy is purchased to charge the battery (there is a maximum rate at which this can occur).  During peak times, energy is first used out of the battery to serve the demand.  Only when the battery is drained (to an acceptable charge level, say 30%) is energy then purchased from the grid to serve demand directly.  No energy is purchased to charge the battery during peak hours.</p>

<center>
<figure>
  <a href="http://www.thetrainingset.com/images/2014-09/Demand-Side Storage Model Flow Chart.jpg"><img src="http://www.thetrainingset.com/images/2014-09/Demand-Side Storage Model Flow Chart.jpg" /></a>
  <figcaption>Flow chart for storage simulation.</figcaption>
</figure>
</center>

<p>If seeing the logic implemented in code would help, it’s below.  I’m not going to put all those functions below as well, needless to say they assign the proper values at each hour.  You could also get them from me on <a href="https://github.com/jtelszasz/demandside_storage">Github</a>.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s">&#39;USAGE&#39;</span><span class="p">])):</span>

        <span class="c"># If at the end of the time series, break out</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s">&#39;USAGE&#39;</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="c"># Peak hours operation</span>
        <span class="k">elif</span> <span class="n">results</span><span class="p">[</span><span class="s">&#39;period&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;peak&#39;</span> <span class="ow">or</span> <span class="n">results</span><span class="p">[</span><span class="s">&#39;period&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;int&#39;</span><span class="p">:</span>

            <span class="c"># If there is enough available in the battery, use it first</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s">&#39;storage_available&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">E_min</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">results</span><span class="p">[</span><span class="s">&#39;USAGE&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">results</span> <span class="o">=</span> <span class="n">peak_battery_only</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

            <span class="c"># Otherwise, use up remainder in battery and then buy from grid</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">results</span> <span class="o">=</span> <span class="n">peak_battery_and_grid</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

        <span class="c"># Off-peak hours operation</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="c"># If the battery isn&#39;t full...</span>
            <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s">&#39;storage_available&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">storage_size_kWh</span><span class="p">:</span>

                <span class="c"># ... top off the battery if it is nearly full...</span>
                <span class="k">if</span> <span class="n">storage_size_kWh</span> <span class="o">-</span> <span class="n">results</span><span class="p">[</span><span class="s">&#39;storage_available&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">P_max_charge</span><span class="p">:</span>
                    <span class="n">results</span> <span class="o">=</span> <span class="n">offpeak_store_to_cap</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                
                <span class="c"># ... otherwise, charge as much as possible in one hour.</span>
                <span class="k">else</span><span class="p">:</span>                    
                    <span class="n">results</span> <span class="o">=</span> <span class="n">offpeak_store_partial</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            
            <span class="c"># If the battery is full, then it isn&#39;t necessary to purchase extra.</span>
            <span class="k">else</span><span class="p">:</span>                
                <span class="n">results</span> <span class="o">=</span> <span class="n">offpeak_battery_full</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span></code></pre></div>

<p>In the plot below, I’ve shown the behavior of the system for a typical summer day.  Peak hours are shaded.  As you can see, during off-peak hours additional energy is purchased in order to recharge the battery.  During peak hours, the battery is discharged preferentially before purchasing any peak-hour electricity in order to minimize cost.</p>

<center>
<figure>
  <a href="http://www.thetrainingset.com/images/2014-09/Daily_Energy_State_13-July-2011.png"><img src="http://www.thetrainingset.com/images/2014-09/Daily_Energy_State_13-July-2011.png" /></a>
  <figcaption>Model behavior for summer weekday, with peak period shaded in gray.</figcaption>
</figure>
</center>

<p>In the above plot there are two energy flows from the grid - one going to serve demand directly and the other to storage.  (There are actually three shown since I separate peak from off-peak, but you get the idea.)  To make a bit clearer how much energy is being purchased at each hour, I’ve summed those two quanities and plotted below.  Clearly in the off-peak hours, a bit extra is being purchased to charge the batteries.  During the first part of the peak period, nothing has to be purchased from the grid since the battery is serving the demand.  Once that is depleted, energy has to be purchased during the remainder of the peak period.</p>

<center>
<figure>
  <a href="http://www.thetrainingset.com/images/2014-09/Daily_Energy_Purchased_13-July-2011.png"><img src="http://www.thetrainingset.com/images/2014-09/Daily_Energy_Purchased_13-July-2011.png" /></a>
  <figcaption>Amount of energy purchased in storage model, with peak period shaded in gray.</figcaption>
</figure>
</center>

<p>It’s important to remember that the actual quantity of killowatt-hours of electricity purchased over the course of the year isn’t different than without storage, it’s just being purchased from the grid at different hours.  The consumer doesn’t need to modify their gluttonous behavior in order to make this work.  The benefit to the consumer is saving money, and the benefit to the utility is shaving peak loads.  </p>

<p>A bunch of questions are already popping up in my head:</p>

<ul>
  <li>What is the payback period for the battery system?</li>
  <li>How do the size of the battery and the peak-off-peak cost differential affect the payback period?</li>
  <li>What percent of hours/energy over the course of the year come through the storage system as opposed to directly from grid?</li>
  <li>How much storage is needed so that peak hour electricity is never purchased and how much does this cost?  What is the payback period?</li>
  <li>How does the cost of the system change with percent of peak-hour demand served by storage?</li>
</ul>

      <footer class="entry-meta">
        <span class="entry-tags"><a href="http://www.thetrainingset.com/tags/#BGE" title="Pages tagged BGE" class="tag">BGE</a><a href="http://www.thetrainingset.com/tags/#Green-Button" title="Pages tagged Green-Button" class="tag">Green-Button</a><a href="http://www.thetrainingset.com/tags/#data" title="Pages tagged data" class="tag">data</a><a href="http://www.thetrainingset.com/tags/#electricity" title="Pages tagged electricity" class="tag">electricity</a><a href="http://www.thetrainingset.com/tags/#dynamic-pricing" title="Pages tagged dynamic-pricing" class="tag">dynamic-pricing</a><a href="http://www.thetrainingset.com/tags/#storage" title="Pages tagged storage" class="tag">storage</a><a href="http://www.thetrainingset.com/tags/#model" title="Pages tagged model" class="tag">model</a><a href="http://www.thetrainingset.com/tags/#demand-side" title="Pages tagged demand-side" class="tag">demand-side</a></span>
        <span><a href="http://www.thetrainingset.com/articles/Intro-To-Storage-Model" rel="bookmark" title="Intro to Storage Model">Intro to Storage Model</a> was published on <span class="entry-date date published updated"><time datetime="2014-09-23T00:00:00-04:00">September 23, 2014</time></span></span>
        (revised: <span class="entry-date date modified"><time datetime="2014-09-23">09/23/2014</time></span>)
        <span class="author vcard"><span class="fn"><a href="http://www.thetrainingset.com/about/" title="About Justin Elszasz">Justin Elszasz</a></span></span>
        <div class="social-share">
          <ul class="socialcount socialcount-small inline-list">
            <li class="facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=http://www.thetrainingset.com/articles/Intro-To-Storage-Model" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Like</span></a></li>
            <li class="twitter"><a href="https://twitter.com/intent/tweet?text=http://www.thetrainingset.com/articles/Intro-To-Storage-Model" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a></li>
            <li class="googleplus"><a href="https://plus.google.com/share?url=http://www.thetrainingset.com/articles/Intro-To-Storage-Model" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a></li>
          </ul>
        </div><!-- /.social-share -->
      </footer>
    </div><!-- /.entry-content -->
    
    
    <div class="read-more">
      
        <div class="read-more-header">
          <a href="http://www.thetrainingset.com/articles/Summer-Update" class="read-more-btn">Read More</a>
        </div><!-- /.read-more-header -->
        <div class="read-more-content">
          <h3><a href="http://www.thetrainingset.com/articles/Daily-Unpaid-Citations" title="Biasing Citations Towards Those Who Pay">Biasing Citations Towards Those Who Pay</a></h3>
          <p>Changes in the proportion of unpaid parking tickets over time. <a href="http://www.thetrainingset.com/articles/Daily-Unpaid-Citations">Continue reading</a></p>
        </div><!-- /.read-more-content -->
      
      <div class="read-more-list">
        
          <div class="list-item">
            <h4><a href="http://www.thetrainingset.com/articles/Rapid-Increase-In-Citations" title="Rapid Increase in Citations">Rapid Increase in Citations</a></h4>
            <span>Published on February 24, 2015</span>
          </div><!-- /.list-item -->
        
          <div class="list-item">
            <h4><a href="http://www.thetrainingset.com/articles/Buiding-My-Elec-Use-Visualization-Site" title="Introducing "My Electricity Use" Visualization Page">Introducing "My Electricity Use" Visualization Page</a></h4>
            <span>Published on February 16, 2015</span>
          </div><!-- /.list-item -->
        
      </div><!-- /.read-more-list -->
      
    </div><!-- /.read-more -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2015 Justin Elszasz. Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <a href="http://mademistakes.com/hpstr/">HPSTR Theme</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://www.thetrainingset.com/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://www.thetrainingset.com/assets/js/scripts.min.js"></script>

	        

</body>
</html>
